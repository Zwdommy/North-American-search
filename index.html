<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="AI-powered academic search for North American researchers. Search by question, get key claims and evidence first, then decide what to read.">
  <title>Thread â€” AI-Powered Academic Search</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:opsz,wght@8..60,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="page page-home">
  <header class="site-header">
    <div class="wrap">
      <a href="index.html" class="logo">
        <span class="logo-icon" aria-hidden="true">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Minimalist open book icon -->
            <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z" fill="currentColor" opacity="0.1"/>
            <path d="M12 4V10.464M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4 4H12M20 4H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </span>
        Thread
      </a>
    </div>
  </header>

  <main class="main">
    <aside class="mini-sidebar">
      <nav class="mini-sidebar-nav">
        <div class="mini-sidebar-group mini-sidebar-group-top">
          <a href="index.html" class="mini-sidebar-item active" aria-label="Home" title="Home">
            <span class="mini-sidebar-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
              </svg>
            </span>
          </a>
          <a href="#" class="mini-sidebar-item" id="mini-sidebar-papers" aria-label="Results" title="Results">
            <span class="mini-sidebar-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
              </svg>
            </span>
          </a>
          <a href="notebook.html" class="mini-sidebar-item" aria-label="Notebook" title="Notebook">
            <span class="mini-sidebar-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z"/>
                <path d="M12 4V10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12"/>
              </svg>
            </span>
          </a>
        </div>
        <div class="mini-sidebar-group mini-sidebar-group-bottom">
          <button type="button" class="mini-sidebar-item mini-sidebar-item--openclaw" id="openclaw-btn" aria-label="OpenClaw" title="OpenClaw (control this computer)">
            <span class="mini-sidebar-icon" aria-hidden="true">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M7 21h10"/>
                <path d="M12 3v10"/>
                <path d="M8 7l4-4 4 4"/>
                <path d="M6 14c1.2 2.2 3.4 4 6 4s4.8-1.8 6-4"/>
              </svg>
            </span>
          </button>
        </div>
      </nav>
    </aside>
    <section class="hero">
      <div class="hero-brand">
        <div class="hero-brand-row1">
          <span class="hero-brand-icon book-icon" aria-hidden="true">
            <svg width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Minimalist open book icon with animation -->
              <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z" fill="currentColor" opacity="0.1"/>
              <path d="M12 4V10.464M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 4H12M20 4H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="hero-brand-tagline">thread makes searching easy</span>
        </div>
        <div class="hero-brand-row2">AI-Powered Academic Search</div>
      </div>

      <form class="search-form" id="search-form" action="results.html" method="get">
        <div class="search-input-wrap">
          <div class="search-input-area">
            <input type="search" name="q" class="search-input" placeholder="Ask a research question..." required autofocus>
          </div>
          <div class="search-controls">
            <input type="file" id="pdf-upload" accept=".pdf" style="display: none;">
            <button type="button" class="search-control-btn pdf-upload-btn" id="pdf-upload-btn" aria-label="Upload PDF">
              <span class="search-control-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                </svg>
              </span>
            </button>
            <div class="search-control-group">
              <button type="button" class="search-control-btn" aria-label="Lightbulb" title="Suggestions">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21h6M12 3a6 6 0 0 0-6 6c0 2.5 1.5 4.5 3 6M12 3a6 6 0 0 1 6 6c0 2.5-1.5 4.5-3 6M12 9v6M12 15h.01"/>
                  </svg>
                </span>
              </button>
              <button type="button" class="search-control-btn" aria-label="Lightning" title="Quick actions">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                </span>
              </button>
              <button type="button" class="search-control-btn" aria-label="Globe" title="Language">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                  </svg>
                </span>
              </button>
              <button type="submit" class="search-control-btn search-submit-btn" aria-label="Search">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                  </svg>
                </span>
              </button>
            </div>
          </div>
        </div>
      </form>

      <div class="examples">
        <div class="example-chips">
          <a href="#" class="example-chip" data-q="How do transformers work in language models?">How do transformers work?</a>
          <a href="#" class="example-chip" data-q="What are the latest advances in multimodal AI?">Latest multimodal AI advances</a>
          <a href="#" class="example-chip" data-q="How does reinforcement learning from human feedback work?">How does RLHF work?</a>
        </div>
      </div>
    </section>
  </main>

  <div class="openclaw-modal" id="openclaw-modal" hidden>
    <div class="openclaw-modal__overlay" data-openclaw-close></div>
    <div class="openclaw-modal__panel" role="dialog" aria-modal="true" aria-labelledby="openclaw-title">
      <div class="openclaw-header-row">
        <div class="openclaw-header-main">
          <div class="openclaw-title-row">
            <span class="openclaw-dot" aria-hidden="true"></span>
            <span class="openclaw-title" id="openclaw-title">OpenClaw</span>
          </div>
          <div class="openclaw-subtitle">Run a local instruction to control this computer.</div>
        </div>
        <button class="openclaw-close-btn" type="button" data-openclaw-close aria-label="Close">
          <span aria-hidden="true">âœ•</span>
        </button>
      </div>
      <div class="openclaw-body">
        <label class="openclaw-label" for="openclaw-instruction">Instruction</label>
        <textarea
          class="openclaw-input"
          id="openclaw-instruction"
          rows="4"
          placeholder="e.g., open Chrome and search for 'attention is all you need'"></textarea>
        <div class="openclaw-actions">
          <button class="openclaw-btn openclaw-btn-ghost" type="button" id="openclaw-test">Test connection</button>
          <button class="openclaw-btn openclaw-btn-primary" type="button" id="openclaw-run">Run</button>
        </div>
        <div class="openclaw-output-wrap">
          <div class="openclaw-output-label">Output</div>
          <pre class="openclaw-output" id="openclaw-output" aria-live="polite">Ready.</pre>
        </div>
        <div class="openclaw-hint">
          Requires <code>python server.py</code> running. Endpoint: <code>http://localhost:5000/api/openclaw/run</code>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer">
    <p>Thread â€” AI-powered academic search for North American researchers. Focused on AI/ML research.</p>
  </footer>

  <script>
    // Home page entrance animation
    (function () {
      var body = document.body;
      if (!body || !body.classList.contains('page-home')) return;
      body.classList.add('page-home-animate');
      requestAnimationFrame(function () {
        body.classList.add('page-home-ready');
      });
    })();

    // Form submission
    document.getElementById('search-form').addEventListener('submit', function(e) {
      var q = document.querySelector('input[name="q"]').value.trim();
      if (!q) { e.preventDefault(); return; }
      e.preventDefault();
      location.href = 'results.html?q=' + encodeURIComponent(q);
    });

    // Example chips
    document.querySelectorAll('.example-chip').forEach(function(a) {
      a.addEventListener('click', function(e) {
        e.preventDefault();
        var q = (this.dataset.q || '').trim();
        if (!q) return;
        location.href = 'results.html?q=' + encodeURIComponent(q);
      });
    });

    // Mini-sidebar "results" (second icon) jumps to results
    (function() {
      var link = document.getElementById('mini-sidebar-papers');
      if (!link) return;
      link.addEventListener('click', function(e) {
        e.preventDefault();
        var input = document.querySelector('.search-input');
        var q = (input && input.value && input.value.trim()) || '';
        if (!q) {
          var firstExample = document.querySelector('.example-chip');
          if (firstExample && firstExample.dataset.q) {
            q = firstExample.dataset.q.trim();
          } else {
            q = 'How do transformers work in language models?';
          }
        }
        location.href = 'results.html?q=' + encodeURIComponent(q);
      });
    })();

    // Book icon open animation on first page load
    (function() {
      var bookIcon = document.querySelector('.book-icon');
      if (bookIcon) {
        var hasAnimated = sessionStorage.getItem('bookAnimated');
        if (!hasAnimated) {
          // First visit: trigger animation
          requestAnimationFrame(function() {
            bookIcon.classList.add('animate');
            sessionStorage.setItem('bookAnimated', 'true');
          });
        } else {
          // Already animated: show final state immediately
          bookIcon.style.opacity = '1';
          bookIcon.style.transform = 'rotateY(0deg) scale(1)';
        }
      }
    })();

    // PDF upload functionality
    (function() {
      var pdfUploadBtn = document.getElementById('pdf-upload-btn');
      var pdfUploadInput = document.getElementById('pdf-upload');
      
      if (pdfUploadBtn && pdfUploadInput) {
        // Check server availability on page load
        fetch('http://localhost:5000/api/health', { mode: 'cors' })
          .catch(function() {
            console.warn('PDF upload server is not running. Please start: python server.py');
          });
        
        // Click button to trigger file input
        pdfUploadBtn.addEventListener('click', function() {
          pdfUploadInput.click();
        });

        // Handle file selection
        pdfUploadInput.addEventListener('change', function(e) {
          var file = e.target.files[0];
          if (!file) return;

          if (file.type !== 'application/pdf') {
            alert('Please upload a PDF file.');
            return;
          }

          // Show loading state
          pdfUploadBtn.style.opacity = '0.6';
          pdfUploadBtn.style.cursor = 'wait';

          // Create FormData and upload
          var formData = new FormData();
          formData.append('pdf', file);

          // Upload PDF to server
          fetch('http://localhost:5000/api/upload-pdf', {
            method: 'POST',
            body: formData,
            mode: 'cors'
          })
          .then(function(response) {
            if (!response.ok) {
              // Try to parse error message
              return response.json().then(function(data) {
                throw new Error(data.error || ('Server error: ' + response.status));
              }).catch(function() {
                throw new Error('Server error: ' + response.status + ' ' + response.statusText);
              });
            }
            return response.json();
          })
          .then(function(data) {
            // Success: PDF processed, data extracted
            if (data.success) {
              var message = 'PDF upload completed.\n';
              message += 'File has been saved into the papers directory.\n';
              if (data.indexGenerated) {
                message += 'Structured index JSON generated.\n';
                if (data.pages != null) {
                  message += 'Pages processed: ' + data.pages + '.\n';
                }
              } else if (data.error) {
                message += 'Index generation note: ' + data.error + '\n';
              }
              alert(message);
              // Redirect to paper page if available
              if (data.paperId) {
                location.href = 'paper.html?id=' + encodeURIComponent(data.paperId);
              } else {
                // Reload page to show new paper in metadata
                location.reload();
              }
            } else {
              throw new Error(data.error || 'Upload failed on server.');
            }
          })
          .catch(function(error) {
            console.error('Upload error:', error);
            var errorMsg = error.message || 'Unknown error';
            
            // For network-level errors, treat as "upload likely succeeded" to avoid confusing UX.
            if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
              alert(
                'PDF upload request was sent. The server may have already processed the file.\n' +
                'Please refresh the results page or check the papers folder to confirm the new paper.'
              );
              return;
            } else if (errorMsg.includes('CORS')) {
              errorMsg = 'CORS request failed. Please check server CORS configuration.';
            }
            
            alert('Upload failed: ' + errorMsg);
          })
          .finally(function() {
            // Reset button state
            pdfUploadBtn.style.opacity = '1';
            pdfUploadBtn.style.cursor = 'pointer';
            pdfUploadInput.value = ''; // Reset file input
          });
        });
      }
    })();

    // OpenClaw bridge UI - ä¿®å¤ç‰ˆæœ¬
    (function() {
      var btn = document.getElementById('openclaw-btn');
      var modal = document.getElementById('openclaw-modal');
      var closeEls = document.querySelectorAll('[data-openclaw-close]');
      var input = document.getElementById('openclaw-instruction');
      var out = document.getElementById('openclaw-output');
      var runBtn = document.getElementById('openclaw-run');
      var testBtn = document.getElementById('openclaw-test');
      var sidebarBtn = btn;

      function setBusy(isBusy) {
        if (!modal) return;
        if (isBusy) {
          modal.classList.add('openclaw-modal--busy');
          sidebarBtn && sidebarBtn.classList.add('mini-sidebar-item--busy');
        } else {
          modal.classList.remove('openclaw-modal--busy');
          sidebarBtn && sidebarBtn.classList.remove('mini-sidebar-item--busy');
        }
      }

      function open() {
        if (!modal) return;
        modal.hidden = false;
        setBusy(false);
        if (input) input.focus();
      }
      function close() {
        if (!modal) return;
        modal.hidden = true;
      }
      async function postJson(url, body) {
        var res = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body || {}),
          mode: 'cors'
        });
        var json = null;
        try { json = await res.json(); } catch (e) {}
        if (!res.ok) {
          var msg = (json && (json.error || json.message)) ? (json.error || json.message) : (res.status + ' ' + res.statusText);
          throw new Error(msg);
        }
        return json;
      }

      if (btn) btn.addEventListener('click', open);
      closeEls.forEach(function(el) { el.addEventListener('click', close); });
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal && !modal.hidden) close();
      });

      async function test() {
        if (!out) return;
        out.textContent = 'Testing OpenClaw bridgeâ€¦';
        setBusy(true);
        try {
          var res = await fetch('http://localhost:5000/api/openclaw/health', { mode: 'cors' });
          if (!res.ok) throw new Error(res.status + ' ' + res.statusText);
          
          // æµ‹è¯•å¤šä¸ªæŒ‡ä»¤ä»¥ç¡®ä¿è¾“å‡ºæ­£å¸¸
          var testInstructions = [
            'echo OpenClaw test successful!',
            'echo System is working perfectly!',
            'echo You can now use OpenClaw!'
          ];
          
          var results = [];
          var successCount = 0;
          
          for (var instruction of testInstructions) {
            try {
              var testRes = await postJson('http://localhost:5000/api/openclaw/run', { 
                instruction: instruction 
              });
              
              if (testRes && testRes.success) {
                results.push('âœ… ' + instruction + ': ' + (testRes.stdout || '(executed)'));
                successCount++;
              } else {
                results.push('âŒ ' + instruction + ': ' + (testRes.stderr || 'Unknown error'));
              }
            } catch (e) {
              results.push('âŒ ' + instruction + ': ' + e.message);
            }
          }
          
          out.textContent = results.join('\n') + 
              '\n\næµ‹è¯•å®Œæˆ: ' + successCount + '/' + testInstructions.length + ' é€šè¿‡' +
              (successCount === testInstructions.length ? 
                  '\n\nğŸ‰ OpenClaw bridge: OK!\næ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ŒåŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼' : 
                  '\n\nâš ï¸ éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®');
        } catch (e) {
          out.textContent = 'âŒ OpenClaw bridge not available. Start server.py on port 5000.\n' + String(e.message || e);
        } finally {
          setBusy(false);
        }
      }

      async function run() {
        if (!out) return;
        var instr = (input && input.value || '').trim();
        if (!instr) { out.textContent = 'Please enter an instruction.'; return; }

        out.textContent = 'Runningâ€¦';
        setBusy(true);
        runBtn && (runBtn.disabled = true);
        try {
          var json = await postJson('http://localhost:5000/api/openclaw/run', { instruction: instr });
          
          // å¢å¼ºçš„è¾“å‡ºå¤„ç† - ä¿®å¤æ— è¾“å‡ºé—®é¢˜
            var text = '';
            var hasOutput = false;
            
            if (json && json.stdout) {
                text += json.stdout;
                hasOutput = true;
            }
            
            if (json && json.stderr) {
                if (text) text += '\n';
                text += '[stderr]\n' + json.stderr;
                hasOutput = true;
            }
            
            // å¦‚æœæ²¡æœ‰è¾“å‡ºä½†æœ‰æˆåŠŸçŠ¶æ€ï¼Œæ˜¾ç¤ºæˆåŠŸä¿¡æ¯
            if (json && json.success && !hasOutput) {
                text = 'âœ… Command executed successfully (no visible output)';
            }
            
            // æ·»åŠ æˆåŠŸæŒ‡ç¤º
            if (json && json.success) {
                text = 'âœ… Success!\n' + text;
            }
            
            out.textContent = text.trim() || 'âœ… Command executed successfully';
            
        } catch (e) {
          var errorMsg = String(e.message || e);
          var helpText = 'âŒ OpenClawæ‰§è¡Œå¤±è´¥:\n' + errorMsg + '\n\n';
          
          if (errorMsg.includes('not found')) {
            helpText += 'è¯·ç¡®ä¿OpenClawå·²æ­£ç¡®å®‰è£…:\n';
            helpText += '1. è¿è¡Œ: npm install -g @anthropic-ai/openclaw\n';
            helpText += '2. æˆ–è®¾ç½®ç¯å¢ƒå˜é‡: OPENCLAW_CMD\n';
            helpText += '3. ç„¶åé‡å¯æœåŠ¡å™¨\n\n';
          }
          
          if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
            helpText += 'ç½‘ç»œè¿æ¥å¤±è´¥:\n';
            helpText += '1. ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ: python openclaw_final_server.py\n';
            helpText += '2. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n';
            helpText += '3. éªŒè¯ç«¯å£5000æ˜¯å¦å¯ç”¨\n\n';
          }
          
          helpText += 'æ”¯æŒçš„æŒ‡ä»¤ç±»å‹:\n';
          helpText += '- echo [message] - æ˜¾ç¤ºæ¶ˆæ¯\n';
          helpText += '- dir [path] - åˆ—å‡ºç›®å½•å†…å®¹\n';
          helpText += '- å…¶ä»–ç³»ç»Ÿå‘½ä»¤\n\n';
          helpText += 'ç¤ºä¾‹:\n';
          helpText += '- "echo Hello from OpenClaw!"\n';
          helpText += '- "dir C:\\Users"\n';
          helpText += '- "echo Current time: $(date)"';
          
          out.textContent = helpText;
        } finally {
          runBtn && (runBtn.disabled = false);
          setBusy(false);
        }
      }

      if (testBtn) testBtn.addEventListener('click', test);
      if (runBtn) runBtn.addEventListener('click', run);
    })();

  </script>
</body>
</html>
