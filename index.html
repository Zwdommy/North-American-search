<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="AI-powered academic search for North American researchers. Search by question, get key claims and evidence first, then decide what to read.">
  <title>Thread — AI-Powered Academic Search</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Source+Serif+4:opsz,wght@8..60,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body class="page">
  <header class="site-header">
    <div class="wrap">
      <a href="index.html" class="logo">
        <span class="logo-icon" aria-hidden="true">
          <svg width="36" height="36" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <!-- Minimalist open book icon -->
            <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z" fill="currentColor" opacity="0.1"/>
            <path d="M12 4V10.464M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M4 4H12M20 4H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </span>
        Thread
      </a>
    </div>
  </header>

  <main class="main">
    <aside class="mini-sidebar">
      <nav class="mini-sidebar-nav">
        <a href="index.html" class="mini-sidebar-item active" aria-label="Home" title="Home">
          <span class="mini-sidebar-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
          </span>
        </a>
        <a href="#" class="mini-sidebar-item" id="mini-sidebar-papers" aria-label="Results" title="Results">
          <span class="mini-sidebar-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/>
            </svg>
          </span>
        </a>
        <a href="notebook.html" class="mini-sidebar-item" aria-label="Notebook" title="Notebook">
          <span class="mini-sidebar-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z"/>
              <path d="M12 4V10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12"/>
            </svg>
          </span>
        </a>
        <a href="#" class="mini-sidebar-item" aria-label="Info" title="About">
          <span class="mini-sidebar-icon" aria-hidden="true">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/>
            </svg>
          </span>
        </a>
      </nav>
    </aside>
    <section class="hero">
      <div class="hero-brand">
        <div class="hero-brand-row1">
          <span class="hero-brand-icon book-icon" aria-hidden="true">
            <svg width="56" height="56" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <!-- Minimalist open book icon with animation -->
              <path d="M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H5C4.448 21 4 20.552 4 20V19.5Z" fill="currentColor" opacity="0.1"/>
              <path d="M12 4V10.464M4 19.5C4 18.837 4.263 18.201 4.732 17.732L12 10.464M4 19.5V20C4 20.552 4.448 21 5 21H12M12 10.464L19.268 17.732C19.737 18.201 20 18.837 20 19.5V20C20 20.552 19.552 21 19 21H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M4 4H12M20 4H12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </span>
          <span class="hero-brand-tagline">thread makes searching easy</span>
        </div>
        <div class="hero-brand-row2">AI-Powered Academic Search</div>
      </div>

      <form class="search-form" id="search-form" action="results.html" method="get">
        <div class="search-input-wrap">
          <div class="search-input-area">
            <input type="search" name="q" class="search-input" placeholder="Ask a research question..." required autofocus>
          </div>
          <div class="search-controls">
            <input type="file" id="pdf-upload" accept=".pdf" style="display: none;">
            <button type="button" class="search-control-btn pdf-upload-btn" id="pdf-upload-btn" aria-label="Upload PDF">
              <span class="search-control-icon" aria-hidden="true">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                </svg>
              </span>
            </button>
            <div class="search-control-group">
              <button type="button" class="search-control-btn" aria-label="Lightbulb" title="Suggestions">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 21h6M12 3a6 6 0 0 0-6 6c0 2.5 1.5 4.5 3 6M12 3a6 6 0 0 1 6 6c0 2.5-1.5 4.5-3 6M12 9v6M12 15h.01"/>
                  </svg>
                </span>
              </button>
              <button type="button" class="search-control-btn" aria-label="Lightning" title="Quick actions">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/>
                  </svg>
                </span>
              </button>
              <button type="button" class="search-control-btn" aria-label="Globe" title="Language">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
                  </svg>
                </span>
              </button>
              <button type="submit" class="search-control-btn search-submit-btn" aria-label="Search">
                <span class="search-control-icon" aria-hidden="true">
                  <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19V5M5 12l7-7 7 7"/>
                  </svg>
                </span>
              </button>
            </div>
          </div>
        </div>
      </form>

      <div class="examples">
        <div class="example-chips">
          <a href="#" class="example-chip" data-q="How do transformers work in language models?">How do transformers work?</a>
          <a href="#" class="example-chip" data-q="What are the latest advances in multimodal AI?">Latest multimodal AI advances</a>
          <a href="#" class="example-chip" data-q="How does reinforcement learning from human feedback work?">How does RLHF work?</a>
        </div>
      </div>
    </section>
  </main>

  <footer class="site-footer">
    <p>Thread — AI-powered academic search for North American researchers. Focused on AI/ML research.</p>
  </footer>

  <script>
    // Form submission
    document.getElementById('search-form').addEventListener('submit', function(e) {
      var q = document.querySelector('input[name="q"]').value.trim();
      if (!q) { e.preventDefault(); return; }
      e.preventDefault();
      location.href = 'results.html?q=' + encodeURIComponent(q);
    });

    // Example chips
    document.querySelectorAll('.example-chip').forEach(function(a) {
      a.addEventListener('click', function(e) {
        e.preventDefault();
        var q = (this.dataset.q || '').trim();
        if (!q) return;
        location.href = 'results.html?q=' + encodeURIComponent(q);
      });
    });

    // Mini-sidebar "results" (second icon) jumps to results
    (function() {
      var link = document.getElementById('mini-sidebar-papers');
      if (!link) return;
      link.addEventListener('click', function(e) {
        e.preventDefault();
        var input = document.querySelector('.search-input');
        var q = (input && input.value && input.value.trim()) || '';
        if (!q) {
          var firstExample = document.querySelector('.example-chip');
          if (firstExample && firstExample.dataset.q) {
            q = firstExample.dataset.q.trim();
          } else {
            q = 'How do transformers work in language models?';
          }
        }
        location.href = 'results.html?q=' + encodeURIComponent(q);
      });
    })();

    // Book icon open animation on first page load
    (function() {
      var bookIcon = document.querySelector('.book-icon');
      if (bookIcon) {
        var hasAnimated = sessionStorage.getItem('bookAnimated');
        if (!hasAnimated) {
          // First visit: trigger animation
          requestAnimationFrame(function() {
            bookIcon.classList.add('animate');
            sessionStorage.setItem('bookAnimated', 'true');
          });
        } else {
          // Already animated: show final state immediately
          bookIcon.style.opacity = '1';
          bookIcon.style.transform = 'rotateY(0deg) scale(1)';
        }
      }
    })();

    // PDF upload functionality
    (function() {
      var pdfUploadBtn = document.getElementById('pdf-upload-btn');
      var pdfUploadInput = document.getElementById('pdf-upload');
      
      if (pdfUploadBtn && pdfUploadInput) {
        // Check server availability on page load
        fetch('http://localhost:5000/api/health', { mode: 'cors' })
          .catch(function() {
            console.warn('PDF上传服务器未运行。请运行: python server.py');
          });
        
        // Click button to trigger file input
        pdfUploadBtn.addEventListener('click', function() {
          pdfUploadInput.click();
        });

        // Handle file selection
        pdfUploadInput.addEventListener('change', function(e) {
          var file = e.target.files[0];
          if (!file) return;

          if (file.type !== 'application/pdf') {
            alert('请上传 PDF 文件');
            return;
          }

          // Show loading state
          pdfUploadBtn.style.opacity = '0.6';
          pdfUploadBtn.style.cursor = 'wait';

          // Create FormData and upload
          var formData = new FormData();
          formData.append('pdf', file);

          // Upload PDF to server
          fetch('http://localhost:5000/api/upload-pdf', {
            method: 'POST',
            body: formData,
            mode: 'cors'
          })
          .then(function(response) {
            if (!response.ok) {
              // Try to parse error message
              return response.json().then(function(data) {
                throw new Error(data.error || '服务器错误: ' + response.status);
              }).catch(function() {
                throw new Error('服务器错误: ' + response.status + ' ' + response.statusText);
              });
            }
            return response.json();
          })
          .then(function(data) {
            // Success: PDF processed, data extracted
            if (data.success) {
              var message = 'PDF 上传成功！\n';
              message += '文件已保存到 papers 目录\n';
              if (data.indexGenerated) {
                message += '已生成结构化索引 JSON\n';
                message += '共处理 ' + (data.pages || 0) + ' 页';
              } else {
                message += '注意：索引生成失败，请检查 MOONSHOT_API_KEY';
              }
              alert(message);
              // Redirect to paper page if available
              if (data.paperId) {
                location.href = 'paper.html?id=' + encodeURIComponent(data.paperId);
              } else {
                // Reload page to show new paper in metadata
                location.reload();
              }
            } else {
              throw new Error(data.error || '处理失败');
            }
          })
          .catch(function(error) {
            console.error('Upload error:', error);
            var errorMsg = error.message || '未知错误';
            
            // Check for specific error types
            if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
              errorMsg = '无法连接到服务器。请确保：\n1. 服务器正在运行 (python server.py)\n2. 服务器地址为 http://localhost:5000\n3. 没有防火墙阻止连接';
            } else if (errorMsg.includes('CORS')) {
              errorMsg = '跨域请求失败。请检查服务器 CORS 配置';
            }
            
            alert('上传失败：' + errorMsg);
          })
          .finally(function() {
            // Reset button state
            pdfUploadBtn.style.opacity = '1';
            pdfUploadBtn.style.cursor = 'pointer';
            pdfUploadInput.value = ''; // Reset file input
          });
        });
      }
    })();

  </script>
</body>
</html>
